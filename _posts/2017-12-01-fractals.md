---
layout: splash
permalink: /fractals/
title: "Fractals"
header:
  overlay_image: /assets/images/fractals/fractals.jpeg
excerpt: "Producing nice pictures of the most famous fractals"
---

```python
from functools import lru_cache
from numba import njit
from PIL import Image, ImageEnhance
import matplotlib.cm as cm
from matplotlib.colors import Normalize
from matplotlib import animation
import matplotlib.pylab as plt
import numpy as np
```


```python
@njit
def compute_julia_set(width, height, zoom, max_iters, c):
    image = np.zeros((width, height), dtype=np.int32)

    for x in range(width):
        for y in range(height):
            z_x = (x - width / 2) / (0.5 * zoom * width)
            z_y = (y - height / 2) / (0.5 * zoom * height)
            z = complex(z_x, z_y)
            for iter in range(max_iters):
                z = z**2 + c
                if z.real**2 + z.imag**2 >= 2:
                    break
            image[x, y] = iter
    return image
```


```python
@lru_cache(maxsize=None)
def get_rbg(iter, max_iters):
    cmap = cm.Spectral
    norm = Normalize(vmin=0, vmax=max_iters)
    r, g, b, _ = cmap(norm(iter))
    return int(r * 255), int(g * 255), int(b * 255)
```


```python
def create_image(image, max_iters):
    width, height = image.shape
    bitmap = Image.new("RGB", (width, height), "white")
    pix = bitmap.load()

    for x in range(width):
        for y in range(height):
            pix[x,y] = get_rbg(image[x, y], max_iters)
    return bitmap
```

The Wikipedia web page on the [Julia Set](https://en.wikipedia.org/wiki/Julia_set) shows a few interesting ones and reports the values of $c$ that generates them, so let's plot a few.


```python
create_image(compute_julia_set(2000, 2000, 0.75, 256, -0.75 + 0.11j), 256)
```




    
![png](/assets/images/fractals/fractals-1.png)
    




```python
create_image(compute_julia_set(2000, 2000, 0.75, 256, -0.1 + 0.651j), 256)
```




    
![png](/assets/images/fractals/fractals-2.png)
    




```python
create_image(compute_julia_set(2000, 2000, 0.75, 256, -0.835 - 0.2321j), 64)
```




    
![png](/assets/images/fractals/fractals-3.png)
    




```python
create_image(compute_julia_set(2000, 2000, 0.75, 1_024, -0.7269 + 0.1889j), 1_024)
```




    
![png](/assets/images/fractals/fractals-4.png)
    



A slightly different fractor is [Mandelbrot set](https://en.wikipedia.org/wiki/Mandelbrot_set). The code is just slightly different, but we approach from a different angle: we zoom around point $0.42611 + 0.198485 i$ and see the rich structure of the fractal, which reproduces itself over and over again as we go to smaller scales. The video generation takes a moment but it is well worth it.


```python
@njit
def compute_mandelbrot_set(width, height, zoom, max_iters):
    image = np.zeros((width, height), dtype=np.int32)

    center = complex(0.42611, 0.198485)

    for x in range(width):
        for y in range(height):
            z = complex(0, 0)
            c_x = (x - width / 2) / (0.5 * zoom * width)
            c_y = (y - height / 2) / (0.5 * zoom * height)
            c = complex(c_x, c_y) + center
            for iter in range(max_iters):
                z = z**2 + c
                if z.real**2 + z.imag**2 >= 2:
                    break
            image[x, y] = iter
    return image
```


```python
# create_image(compute_mandelbrot_set(1000, 1000, 100_000_000_000, 512), 512)
```


```python
levels = [1.25**k for k in range(100)]
images = []
for zoom in levels:
    image = create_image(compute_mandelbrot_set(2000, 2000, zoom, 512), 512)
    enhancer = ImageEnhance.Brightness(image)
    enhancer.enhance(2)
    images.append(np.array(image))
```


```python
video = np.array(images[:]) 

fig = plt.figure(figsize=(8, 8))
im = plt.imshow(video[0,:,:,:])
plt.axis('off')
plt.close() # this is required to not display the generated image

def init():
    im.set_data(video[0,:,:,:])

def animate(i):
    im.set_data(video[i,:,:,:])
    return im

anim = animation.FuncAnimation(fig, animate, init_func=init, frames=video.shape[0], interval=150)
anim.save('mandelbrot-zoom.gif', writer='pillow')
```

![](mandelbrot-zoom.gif)

This concludes our short excursion on fractals. 
